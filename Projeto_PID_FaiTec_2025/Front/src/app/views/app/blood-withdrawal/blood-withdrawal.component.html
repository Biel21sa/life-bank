<div class="withdrawal-container">
  <mat-card class="withdrawal-card">
    <mat-card-header>
      <mat-card-title>Retirada de Bolsas de Sangue</mat-card-title>
      <mat-card-subtitle>Selecione as bolsas e informe o motivo da retirada</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Tabela de Bolsas -->
      <div class="table-container">
        <table mat-table [dataSource]="bloodList" class="blood-table">

          <!-- Checkbox Column -->
          <ng-container matColumnDef="select">
            <th mat-header-cell *matHeaderCellDef>Selecionar</th>
            <td mat-cell *matCellDef="let row">
              <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(row) : null"
                [checked]="selection.isSelected(row)">
              </mat-checkbox>
            </td>
          </ng-container>

          <!-- Blood Type Column -->
          <ng-container matColumnDef="bloodType">
            <th mat-header-cell *matHeaderCellDef>Tipo Sanguíneo</th>
            <td mat-cell *matCellDef="let blood">{{blood.bloodType}}</td>
          </ng-container>

          <!-- Quantity Column -->
          <ng-container matColumnDef="quantity">
            <th mat-header-cell *matHeaderCellDef>Quantidade (ml)</th>
            <td mat-cell *matCellDef="let blood">{{blood.quantity}}</td>
          </ng-container>

          <!-- Expiration Date Column -->
          <ng-container matColumnDef="expirationDate">
            <th mat-header-cell *matHeaderCellDef>Data de Validade</th>
            <td mat-cell *matCellDef="let blood">{{blood.expirationDate | date:'dd/MM/yyyy'}}</td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>

      <!-- Formulário de Motivo -->
      <form [formGroup]="withdrawalForm" (ngSubmit)="onSubmit()" class="withdrawal-form">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Motivo da Retirada</mat-label>
          <textarea matInput formControlName="reason" rows="4"
            placeholder="Descreva o motivo da retirada das bolsas de sangue...">
          </textarea>
          <mat-error *ngIf="withdrawalForm.get('reason')?.hasError('required')">
            Motivo é obrigatório
          </mat-error>
          <mat-error *ngIf="withdrawalForm.get('reason')?.hasError('minlength')">
            Motivo deve ter pelo menos 10 caracteres
          </mat-error>
        </mat-form-field>
      </form>
    </mat-card-content>

    <mat-card-actions class="card-actions">
      <button mat-button type="button" (click)="goBack()">
        Cancelar
      </button>
      <button mat-raised-button color="primary" (click)="onSubmit()"
        [disabled]="!withdrawalForm.valid || selection.selected.length === 0">
        Confirmar Retirada ({{selection.selected.length}} selecionadas)
      </button>
    </mat-card-actions>
  </mat-card>
</div>